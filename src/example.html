<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æºè’¸é¦ä¸“å®¶æ¨¡å‹ - ç¥ç»ç½‘ç»œæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 1400px;
            width: 100%;
            height: 90vh;
            display: flex;
            gap: 20px;
        }

        .left-panel {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: flex-start;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .title {
            color: #333;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            text-align: center;
        }

        .layer-info {
            background: rgba(0, 0, 0, 0.05);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
        }

        .layer-info h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 16px;
        }

        .layer-info p {
            margin: 0 0 5px 0;
            color: #666;
        }

        .layer-nodes {
            font-size: 12px;
            color: #888;
            line-height: 1.4;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-input {
            background: rgba(0, 0, 0, 0.05);
            padding: 20px;
            border-radius: 15px;
        }

        .user-input h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #333;
        }

        .user-input textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
        }

        .network {
            position: relative;
            width: 100%;
            flex: 1;
            min-height: 500px;
            overflow: hidden;
        }

        .legend {
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .layer {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            height: 100%;
        }

        .input-layer {
            left: 5%;
            width: 15%;
        }

        .hidden-layer-1 {
            left: 30%;
            width: 15%;
        }

        .hidden-layer-2 {
            left: 55%;
            width: 15%;
        }

        .output-layer {
            left: 80%;
            width: 15%;
        }

        .node {
            position: relative;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-align: center;
            font-size: 12px;
            line-height: 1.2;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .node:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .water-source {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #4FC3F7, #29B6F6);
            animation: pulse 2s infinite;
        }

        .material {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #66BB6A, #4CAF50);
            margin: 10px 0;
        }

        .distillation {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #FF7043, #FF5722);
            margin: 5px 0;
        }

        .expert {
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, #AB47BC, #9C27B0);
            margin: 15px 0;
        }

        .connection {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));
            transform-origin: left center;
            opacity: 0.6;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .connection.active {
            background: linear-gradient(90deg, #FFD54F, #FFC107, #FFD54F, #FFC107);
            background-size: 200% 100%;
            opacity: 1;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
            animation: dataFlow 1.5s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes flow {
            0% { 
                transform: scaleX(0);
                opacity: 0.3;
            }
            50% { 
                transform: scaleX(1);
                opacity: 1;
            }
            100% { 
                transform: scaleX(0);
                opacity: 0.3;
            }
        }

        @keyframes dataFlow {
            0% {
                background-position: 0% 50%;
            }
            100% {
                background-position: 100% 50%;
            }
        }

        @keyframes nodeActivate {
            0% { 
                transform: scale(1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }
            50% { 
                transform: scale(1.15);
                box-shadow: 0 8px 20px rgba(255, 255, 255, 0.4);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }
        }

        .node.active {
            animation: nodeActivate 0.8s ease-in-out;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            white-space: nowrap;
        }

        .node:hover .tooltip {
            opacity: 1;
        }

        .config-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .config-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 60px;
            resize: vertical;
        }

        .features-list {
            margin-top: 10px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .feature-item input {
            flex: 1;
            margin-right: 10px;
        }

        .add-feature-btn, .remove-feature-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .add-feature-btn {
            background: #4CAF50;
            color: white;
            margin-top: 10px;
        }

        .remove-feature-btn {
            background: #f44336;
            color: white;
        }

        .save-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        .example-config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .pathway-config {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .layer-select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <h1 class="title">æ°´æºè’¸é¦ä¸“å®¶æ¨¡å‹<br>ç¥ç»ç½‘ç»œæ¼”ç¤º</h1>
            
            <div class="controls">
                <button class="btn" onclick="startAnimation()">ğŸš€ å¼€å§‹è’¸é¦è¿‡ç¨‹</button>
                <button class="btn" onclick="resetAnimation()">ğŸ”„ é‡ç½®æ¼”ç¤º</button>
                <button class="btn" onclick="toggleConnections()">ğŸ‘ï¸ æ˜¾ç¤º/éšè—è¿æ¥</button>
            </div>
            
            <div class="user-input">
                <h3>ğŸ’­ è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ï¼š</h3>
                <textarea id="userQuestion" placeholder="ä¾‹å¦‚ï¼šæˆ‘éœ€è¦ä¸€ä¸ªé«˜è´¨é‡ã€ä½æˆæœ¬çš„è’¸é¦æ–¹æ¡ˆ..."></textarea>
                <button class="btn" onclick="analyzeQuestion()">ğŸ¤– AIæ™ºèƒ½åˆ†æ</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="network" id="network">
                <!-- è¾“å…¥å±‚ï¼šæ°´æº -->
                <div class="layer input-layer">
                    <div class="node water-source" data-layer="input" data-index="0" id="node-A1">
                        <span class="node-text">æ°´æº</span>
                        <div class="tooltip">çº¯å‡€æ°´æº - ç³»ç»Ÿè¾“å…¥</div>
                    </div>
                </div>

                <!-- ç¬¬ä¸€éšè—å±‚ï¼šåŸææ–™ -->
                <div class="layer hidden-layer-1">
                    <div class="node material" data-layer="material" data-index="0" id="node-B1">
                        <span class="node-text">ç³–åŒ–é…¶</span>
                        <div class="tooltip">ç³–åŒ–é…¶ - å‚¬åŒ–è½¬åŒ–</div>
                    </div>
                    <div class="node material" data-layer="material" data-index="1" id="node-B2">
                        <span class="node-text">é…µæ¯èŒ</span>
                        <div class="tooltip">é…µæ¯èŒ - å‘é…µæ ¸å¿ƒ</div>
                    </div>
                    <div class="node material" data-layer="material" data-index="2" id="node-B3">
                        <span class="node-text">è¥å…»ç›</span>
                        <div class="tooltip">è¥å…»ç› - æä¾›å…»åˆ†</div>
                    </div>
                    <div class="node material" data-layer="material" data-index="3" id="node-B4">
                        <span class="node-text">pHè°ƒèŠ‚å‰‚</span>
                        <div class="tooltip">pHè°ƒèŠ‚å‰‚ - ç¯å¢ƒä¼˜åŒ–</div>
                    </div>
                </div>

                <!-- ç¬¬äºŒéšè—å±‚ï¼šè’¸é¦æ–¹æ³• -->
                <div class="layer hidden-layer-2">
                    <div class="node distillation" data-layer="distillation" data-index="0" id="node-C1">
                        <span class="node-text">å•æ¬¡è’¸é¦</span>
                        <div class="tooltip">å•æ¬¡è’¸é¦ - åŸºç¡€åˆ†ç¦»</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="1" id="node-C2">
                        <span class="node-text">äºŒæ¬¡è’¸é¦</span>
                        <div class="tooltip">äºŒæ¬¡è’¸é¦ - ç²¾ç»†æçº¯</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="2" id="node-C3">
                        <span class="node-text">åˆ†é¦è’¸é¦</span>
                        <div class="tooltip">åˆ†é¦è’¸é¦ - åˆ†æ®µæ”¶é›†</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="3" id="node-C4">
                        <span class="node-text">å‡å‹è’¸é¦</span>
                        <div class="tooltip">å‡å‹è’¸é¦ - ä½æ¸©å¤„ç†</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="4" id="node-C5">
                        <span class="node-text">æ°´è’¸æ°”è’¸é¦</span>
                        <div class="tooltip">æ°´è’¸æ°”è’¸é¦ - æ¸©å’Œæå–</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="5" id="node-C6">
                        <span class="node-text">å…±æ²¸è’¸é¦</span>
                        <div class="tooltip">å…±æ²¸è’¸é¦ - ç»„åˆ†åˆ†ç¦»</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="6" id="node-C7">
                        <span class="node-text">åˆ†å­è’¸é¦</span>
                        <div class="tooltip">åˆ†å­è’¸é¦ - é«˜çº¯åº¦</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="7" id="node-C8">
                        <span class="node-text">è†œè’¸é¦</span>
                        <div class="tooltip">è†œè’¸é¦ - æ–°å‹æŠ€æœ¯</div>
                    </div>
                    <div class="node distillation" data-layer="distillation" data-index="8" id="node-C9">
                        <span class="node-text">ååº”è’¸é¦</span>
                        <div class="tooltip">ååº”è’¸é¦ - ä¸€ä½“åŒ–</div>
                    </div>
                </div>

                <!-- è¾“å‡ºå±‚ï¼šä¸“å®¶æ¨¡å‹ -->
                <div class="layer output-layer">
                    <div class="node expert" data-layer="expert" data-index="0" id="node-D1">
                        <span class="node-text">è´¨é‡ä¸“å®¶</span>
                        <div class="tooltip">è´¨é‡æ§åˆ¶ä¸“å®¶æ¨¡å‹</div>
                    </div>
                    <div class="node expert" data-layer="expert" data-index="1" id="node-D2">
                        <span class="node-text">æ•ˆç‡ä¸“å®¶</span>
                        <div class="tooltip">ç”Ÿäº§æ•ˆç‡ä¸“å®¶æ¨¡å‹</div>
                    </div>
                    <div class="node expert" data-layer="expert" data-index="2" id="node-D3">
                        <span class="node-text">æˆæœ¬ä¸“å®¶</span>
                        <div class="tooltip">æˆæœ¬ä¼˜åŒ–ä¸“å®¶æ¨¡å‹</div>
                    </div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(45deg, #4FC3F7, #29B6F6);"></div>
                    <span>æ°´æºè¾“å…¥å±‚</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(45deg, #66BB6A, #4CAF50);"></div>
                    <span>åŸææ–™å±‚</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(45deg, #FF7043, #FF5722);"></div>
                    <span>è’¸é¦æ–¹æ³•å±‚</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(45deg, #AB47BC, #9C27B0);"></div>
                    <span>ä¸“å®¶æ¨¡å‹è¾“å‡ºå±‚</span>
                </div>
            </div>
        </div>
    </div>

    <button class="config-btn" onclick="openConfig()">âš™ï¸ é…ç½®</button>

    <!-- é…ç½®å¼¹çª— -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeConfig()">&times;</span>
            <h2>ç³»ç»Ÿé…ç½®</h2>
            
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('layer1')">ç¬¬ä¸€å±‚é…ç½®</button>
                <button class="tab-button" onclick="showTab('layer2')">ç¬¬äºŒå±‚é…ç½®</button>
                <button class="tab-button" onclick="showTab('layer3')">ç¬¬ä¸‰å±‚é…ç½®</button>
                <button class="tab-button" onclick="showTab('layer4')">ç¬¬å››å±‚é…ç½®</button>
                <button class="tab-button" onclick="showTab('examples')">ç¤ºä¾‹é…ç½®</button>
                <button class="tab-button" onclick="showTab('openai')">AIé…ç½®</button>
            </div>

            <!-- å±‚çº§é…ç½®TAB -->
            <div id="layer1" class="tab-content active">
                <h3>ç¬¬ä¸€å±‚ - è¾“å…¥å±‚é…ç½®</h3>
                <div class="form-group">
                    <label>å±‚åç§°ï¼š</label>
                    <input type="text" id="layer1Name" value="æ°´æºè¾“å…¥å±‚">
                </div>
                <div class="form-group">
                    <label>å±‚å«ä¹‰ï¼š</label>
                    <textarea id="layer1Meaning">ç³»ç»Ÿçš„åŸå§‹è¾“å…¥æ•°æ®æº</textarea>
                </div>
                <div class="form-group">
                    <label>èŠ‚ç‚¹åç§°ï¼š</label>
                    <div id="layer1Nodes" class="features-list"></div>
                </div>
                <div class="form-group">
                    <label>ç‰¹å¾åˆ—è¡¨ï¼š</label>
                    <div id="layer1Features" class="features-list"></div>
                    <button class="add-feature-btn" onclick="addFeature('layer1')">æ·»åŠ ç‰¹å¾</button>
                </div>
            </div>

            <div id="layer2" class="tab-content">
                <h3>ç¬¬äºŒå±‚ - åŸææ–™å±‚é…ç½®</h3>
                <div class="form-group">
                    <label>å±‚åç§°ï¼š</label>
                    <input type="text" id="layer2Name" value="åŸææ–™å±‚">
                </div>
                <div class="form-group">
                    <label>å±‚å«ä¹‰ï¼š</label>
                    <textarea id="layer2Meaning">å¤„ç†è¾“å…¥çš„å„ç§åŸææ–™å’Œå‚¬åŒ–å‰‚</textarea>
                </div>
                <div class="form-group">
                    <label>èŠ‚ç‚¹åç§°ï¼š</label>
                    <div id="layer2Nodes" class="features-list"></div>
                </div>
                <div class="form-group">
                    <label>ç‰¹å¾åˆ—è¡¨ï¼š</label>
                    <div id="layer2Features" class="features-list"></div>
                    <button class="add-feature-btn" onclick="addFeature('layer2')">æ·»åŠ ç‰¹å¾</button>
                </div>
            </div>

            <div id="layer3" class="tab-content">
                <h3>ç¬¬ä¸‰å±‚ - è’¸é¦æ–¹æ³•å±‚é…ç½®</h3>
                <div class="form-group">
                    <label>å±‚åç§°ï¼š</label>
                    <input type="text" id="layer3Name" value="è’¸é¦æ–¹æ³•å±‚">
                </div>
                <div class="form-group">
                    <label>å±‚å«ä¹‰ï¼š</label>
                    <textarea id="layer3Meaning">å„ç§è’¸é¦æŠ€æœ¯å’Œå¤„ç†æ–¹æ³•</textarea>
                </div>
                <div class="form-group">
                    <label>èŠ‚ç‚¹åç§°ï¼š</label>
                    <div id="layer3Nodes" class="features-list"></div>
                </div>
                <div class="form-group">
                    <label>ç‰¹å¾åˆ—è¡¨ï¼š</label>
                    <div id="layer3Features" class="features-list"></div>
                    <button class="add-feature-btn" onclick="addFeature('layer3')">æ·»åŠ ç‰¹å¾</button>
                </div>
            </div>

            <div id="layer4" class="tab-content">
                <h3>ç¬¬å››å±‚ - è¾“å‡ºå±‚é…ç½®</h3>
                <div class="form-group">
                    <label>å±‚åç§°ï¼š</label>
                    <input type="text" id="layer4Name" value="ä¸“å®¶æ¨¡å‹è¾“å‡ºå±‚">
                </div>
                <div class="form-group">
                    <label>å±‚å«ä¹‰ï¼š</label>
                    <textarea id="layer4Meaning">æœ€ç»ˆçš„ä¸“å®¶å†³ç­–è¾“å‡º</textarea>
                </div>
                <div class="form-group">
                    <label>èŠ‚ç‚¹åç§°ï¼š</label>
                    <div id="layer4Nodes" class="features-list"></div>
                </div>
                <div class="form-group">
                    <label>ç‰¹å¾åˆ—è¡¨ï¼š</label>
                    <div id="layer4Features" class="features-list"></div>
                    <button class="add-feature-btn" onclick="addFeature('layer4')">æ·»åŠ ç‰¹å¾</button>
                </div>
            </div>

            <!-- ç¤ºä¾‹é…ç½®TAB -->
            <div id="examples" class="tab-content">
                <h3>ç¤ºä¾‹é…ç½® - ä¼ æ’­è·¯å¾„</h3>
                <div id="examplesList">
                    <div class="example-config">
                        <h4>ç¤ºä¾‹1ï¼šè´¨é‡ä¼˜åŒ–è·¯å¾„</h4>
                        <p>ç”¨æˆ·é—®é¢˜ï¼šéœ€è¦é«˜è´¨é‡äº§å“</p>
                        <p>æ¨èè·¯å¾„ï¼šA1 â†’ B1,B2 â†’ C1,C3,C5 â†’ D1</p>
                        <p>é€»è¾‘ï¼šä½¿ç”¨ç³–åŒ–é…¶å’Œé…µæ¯èŒï¼Œé€šè¿‡ç²¾ç»†è’¸é¦æ–¹æ³•ï¼Œè¾“å‡ºåˆ°è´¨é‡ä¸“å®¶</p>
                    </div>
                    <div class="example-config">
                        <h4>ç¤ºä¾‹2ï¼šæ•ˆç‡ä¼˜åŒ–è·¯å¾„</h4>
                        <p>ç”¨æˆ·é—®é¢˜ï¼šéœ€è¦å¿«é€Ÿç”Ÿäº§</p>
                        <p>æ¨èè·¯å¾„ï¼šA1 â†’ B2,B4 â†’ C2,C4,C6,C8 â†’ D2</p>
                        <p>é€»è¾‘ï¼šä½¿ç”¨å¿«é€Ÿå‘é…µå’Œç¯å¢ƒä¼˜åŒ–ï¼Œé‡‡ç”¨é«˜æ•ˆè’¸é¦æ–¹æ³•ï¼Œè¾“å‡ºåˆ°æ•ˆç‡ä¸“å®¶</p>
                    </div>
                </div>
                <button class="add-feature-btn" onclick="addExample()">æ·»åŠ ç¤ºä¾‹</button>
            </div>

            <!-- OpenAIé…ç½®TAB -->
            <div id="openai" class="tab-content">
                <h3>OpenAI API é…ç½®</h3>
                <div class="form-group">
                    <label>API URLï¼š</label>
                    <input type="text" id="openaiUrl" value="https://api.openai.com/v1/chat/completions">
                </div>
                <div class="form-group">
                    <label>API Keyï¼š</label>
                    <input type="password" id="openaiKey" placeholder="è¾“å…¥æ‚¨çš„OpenAI API Key">
                </div>
                <div class="form-group">
                    <label>æ¨¡å‹åç§°ï¼š</label>
                    <input type="text" id="openaiModel" value="gpt-3.5-turbo">
                </div>
            </div>

            <button class="save-btn" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
        </div>
    </div>

    <script>
        let connections = [];
        let animationRunning = false;
        let connectionsVisible = true;
        let currentConfig = {
            layers: {
                layer1: { 
                    name: 'æ°´æºè¾“å…¥å±‚', 
                    meaning: 'ç³»ç»Ÿçš„åŸå§‹è¾“å…¥æ•°æ®æº', 
                    nodes: [
                        { 
                            name: 'æ°´æº', 
                            description: 'çº¯å‡€æ°´æº - ç³»ç»Ÿè¾“å…¥',
                            features: ['çº¯å‡€åº¦', 'æ¸©åº¦', 'å‹åŠ›', 'pHå€¼']
                        }
                    ],
                    features: ['çº¯å‡€åº¦', 'æ¸©åº¦', 'å‹åŠ›'] 
                },
                layer2: { 
                    name: 'åŸææ–™å±‚', 
                    meaning: 'å¤„ç†è¾“å…¥çš„å„ç§åŸææ–™å’Œå‚¬åŒ–å‰‚', 
                    nodes: [
                        { 
                            name: 'ç³–åŒ–é…¶', 
                            description: 'ç³–åŒ–é…¶ - å‚¬åŒ–è½¬åŒ–',
                            features: ['æ´»æ€§', 'ç¨³å®šæ€§', 'é€‰æ‹©æ€§', 'æ¸©åº¦é€‚åº”æ€§']
                        },
                        { 
                            name: 'é…µæ¯èŒ', 
                            description: 'é…µæ¯èŒ - å‘é…µæ ¸å¿ƒ',
                            features: ['å‘é…µèƒ½åŠ›', 'é…’ç²¾è€å—æ€§', 'ç¹æ®–é€Ÿåº¦', 'è¥å…»éœ€æ±‚']
                        },
                        { 
                            name: 'è¥å…»ç›', 
                            description: 'è¥å…»ç› - æä¾›å…»åˆ†',
                            features: ['æº¶è§£åº¦', 'è¥å…»ä»·å€¼', 'çº¯åº¦', 'ç¨³å®šæ€§']
                        },
                        { 
                            name: 'pHè°ƒèŠ‚å‰‚', 
                            description: 'pHè°ƒèŠ‚å‰‚ - ç¯å¢ƒä¼˜åŒ–',
                            features: ['ç¼“å†²èƒ½åŠ›', 'è°ƒèŠ‚èŒƒå›´', 'ç¨³å®šæ€§', 'å‰¯ä½œç”¨']
                        }
                    ],
                    features: ['å‚¬åŒ–æ•ˆç‡', 'ååº”é€Ÿåº¦', 'ç¨³å®šæ€§', 'æˆæœ¬'] 
                },
                layer3: { 
                    name: 'è’¸é¦æ–¹æ³•å±‚', 
                    meaning: 'å„ç§è’¸é¦æŠ€æœ¯å’Œå¤„ç†æ–¹æ³•', 
                    nodes: [
                        { 
                            name: 'å•æ¬¡è’¸é¦', 
                            description: 'å•æ¬¡è’¸é¦ - åŸºç¡€åˆ†ç¦»',
                            features: ['åˆ†ç¦»æ•ˆç‡', 'èƒ½è€—', 'æ“ä½œç®€ä¾¿æ€§', 'æˆæœ¬']
                        },
                        { 
                            name: 'äºŒæ¬¡è’¸é¦', 
                            description: 'äºŒæ¬¡è’¸é¦ - ç²¾ç»†æçº¯',
                            features: ['çº¯åº¦æå‡', 'æ—¶é—´æˆæœ¬', 'èƒ½è€—', 'è®¾å¤‡è¦æ±‚']
                        },
                        { 
                            name: 'åˆ†é¦è’¸é¦', 
                            description: 'åˆ†é¦è’¸é¦ - åˆ†æ®µæ”¶é›†',
                            features: ['åˆ†ç¦»ç²¾åº¦', 'äº§ç‰©ç§ç±»', 'æ§åˆ¶å¤æ‚åº¦', 'è®¾å¤‡æŠ•èµ„']
                        },
                        { 
                            name: 'å‡å‹è’¸é¦', 
                            description: 'å‡å‹è’¸é¦ - ä½æ¸©å¤„ç†',
                            features: ['ä½æ¸©æ“ä½œ', 'çƒ­æ•ä¿æŠ¤', 'çœŸç©ºè¦æ±‚', 'è®¾å¤‡å¤æ‚åº¦']
                        },
                        { 
                            name: 'æ°´è’¸æ°”è’¸é¦', 
                            description: 'æ°´è’¸æ°”è’¸é¦ - æ¸©å’Œæå–',
                            features: ['æ¸©å’Œæ€§', 'é€‚ç”¨èŒƒå›´', 'æ°´æ¶ˆè€—', 'åˆ†ç¦»æ•ˆæœ']
                        },
                        { 
                            name: 'å…±æ²¸è’¸é¦', 
                            description: 'å…±æ²¸è’¸é¦ - ç»„åˆ†åˆ†ç¦»',
                            features: ['å…±æ²¸ç ´é™¤', 'æº¶å‰‚å›æ”¶', 'æŠ€æœ¯éš¾åº¦', 'ç¯ä¿æ€§']
                        },
                        { 
                            name: 'åˆ†å­è’¸é¦', 
                            description: 'åˆ†å­è’¸é¦ - é«˜çº¯åº¦',
                            features: ['è¶…é«˜çº¯åº¦', 'é«˜çœŸç©º', 'è®¾å¤‡æŠ•èµ„', 'æ“ä½œéš¾åº¦']
                        },
                        { 
                            name: 'è†œè’¸é¦', 
                            description: 'è†œè’¸é¦ - æ–°å‹æŠ€æœ¯',
                            features: ['èŠ‚èƒ½æ€§', 'è†œå¯¿å‘½', 'æŠ€æœ¯æ–°é¢–', 'åº”ç”¨å‰æ™¯']
                        },
                        { 
                            name: 'ååº”è’¸é¦', 
                            description: 'ååº”è’¸é¦ - ä¸€ä½“åŒ–',
                            features: ['ä¸€ä½“åŒ–', 'æ•ˆç‡æå‡', 'è®¾å¤‡é›†æˆ', 'æ§åˆ¶å¤æ‚åº¦']
                        }
                    ],
                    features: ['åˆ†ç¦»ç²¾åº¦', 'å¤„ç†é€Ÿåº¦', 'èƒ½è€—', 'æŠ€æœ¯å¤æ‚åº¦', 'äº§å“çº¯åº¦'] 
                },
                layer4: { 
                    name: 'ä¸“å®¶æ¨¡å‹è¾“å‡ºå±‚', 
                    meaning: 'æœ€ç»ˆçš„ä¸“å®¶å†³ç­–è¾“å‡º', 
                    nodes: [
                        { 
                            name: 'è´¨é‡ä¸“å®¶', 
                            description: 'è´¨é‡æ§åˆ¶ä¸“å®¶æ¨¡å‹',
                            features: ['çº¯åº¦è¯„ä¼°', 'æ‚è´¨æ£€æµ‹', 'æ ‡å‡†ç¬¦åˆæ€§', 'è´¨é‡ç¨³å®šæ€§']
                        },
                        { 
                            name: 'æ•ˆç‡ä¸“å®¶', 
                            description: 'ç”Ÿäº§æ•ˆç‡ä¸“å®¶æ¨¡å‹',
                            features: ['äº§å‡ºé€Ÿåº¦', 'è®¾å¤‡åˆ©ç”¨ç‡', 'äººå·¥æ•ˆç‡', 'æ—¶é—´ä¼˜åŒ–']
                        },
                        { 
                            name: 'æˆæœ¬ä¸“å®¶', 
                            description: 'æˆæœ¬ä¼˜åŒ–ä¸“å®¶æ¨¡å‹',
                            features: ['åŸæ–™æˆæœ¬', 'è®¾å¤‡æˆæœ¬', 'äººå·¥æˆæœ¬', 'ç»¼åˆæˆæœ¬']
                        }
                    ],
                    features: ['è´¨é‡è¯„ä¼°', 'æ•ˆç‡è¯„ä¼°', 'æˆæœ¬è¯„ä¼°'] 
                }
            },
            examples: [
                { question: 'éœ€è¦é«˜è´¨é‡äº§å“', path: 'A1â†’B1,B2â†’C1,C3,C5â†’D1', logic: 'ä½¿ç”¨ç³–åŒ–é…¶å’Œé…µæ¯èŒï¼Œé€šè¿‡ç²¾ç»†è’¸é¦æ–¹æ³•ï¼Œè¾“å‡ºåˆ°è´¨é‡ä¸“å®¶' },
                { question: 'éœ€è¦å¿«é€Ÿç”Ÿäº§', path: 'A1â†’B2,B4â†’C2,C4,C6,C8â†’D2', logic: 'ä½¿ç”¨å¿«é€Ÿå‘é…µå’Œç¯å¢ƒä¼˜åŒ–ï¼Œé‡‡ç”¨é«˜æ•ˆè’¸é¦æ–¹æ³•ï¼Œè¾“å‡ºåˆ°æ•ˆç‡ä¸“å®¶' }
            ],
            openai: {
                url: 'https://api.openai.com/v1/chat/completions',
                key: '',
                model: 'gpt-3.5-turbo'
            }
        };

        // å®šä¹‰æ¯å±‚çš„èŠ‚ç‚¹æ•°é‡
        const layerNodeCounts = {
            layer1: 1,
            layer2: 4, 
            layer3: 9,
            layer4: 3
        };
        
        // å®šä¹‰ä¸‰æ¡ç‰¹å®šè·¯å¾„
        const pathways = {
            pathway1: {
                name: 'è´¨é‡ä¸“å®¶è·¯å¾„',
                color: '#4FC3F7',
                path: [
                    { from: 'A1', to: ['B1', 'B2'] },
                    { from: ['B1', 'B2'], to: ['C1', 'C3', 'C5'] },
                    { from: ['C1', 'C3', 'C5'], to: ['D1'] }
                ]
            },
            pathway2: {
                name: 'æ•ˆç‡ä¸“å®¶è·¯å¾„', 
                color: '#66BB6A',
                path: [
                    { from: 'A1', to: ['B2', 'B4'] },
                    { from: ['B2', 'B4'], to: ['C2', 'C4', 'C6', 'C8'] },
                    { from: ['C2', 'C4', 'C6', 'C8'], to: ['D2'] }
                ]
            },
            pathway3: {
                name: 'æˆæœ¬ä¸“å®¶è·¯å¾„',
                color: '#FF7043', 
                path: [
                    { from: 'A1', to: ['B1', 'B3', 'B4'] },
                    { from: ['B1', 'B3', 'B4'], to: ['C1', 'C7', 'C9'] },
                    { from: ['C1', 'C7', 'C9'], to: ['D3'] }
                ]
            }
        };

        // é…ç½®ç›¸å…³å‡½æ•°
        function openConfig() {
            document.getElementById('configModal').style.display = 'block';
            loadConfig();
        }

        function closeConfig() {
            document.getElementById('configModal').style.display = 'none';
        }

        function showTab(tabName) {
            // éšè—æ‰€æœ‰TABå†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„TAB
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function addFeature(layerId) {
            const container = document.getElementById(layerId + 'Features');
            const featureDiv = document.createElement('div');
            featureDiv.className = 'feature-item';
            featureDiv.innerHTML = `
                <input type="text" placeholder="è¾“å…¥ç‰¹å¾åç§°">
                <button class="remove-feature-btn" onclick="this.parentElement.remove()">åˆ é™¤</button>
            `;
            container.appendChild(featureDiv);
        }

        function addNodeFeature(button) {
            const container = button.parentElement.querySelector('.node-features-list');
            const featureDiv = document.createElement('div');
            featureDiv.className = 'feature-item';
            featureDiv.style.cssText = 'display: flex; align-items: center; margin-bottom: 8px; padding: 6px; background: white; border-radius: 5px; border: 1px solid #e9ecef;';
            featureDiv.innerHTML = `
                <input type="text" placeholder="è¾“å…¥ç‰¹å¾åç§°" style="flex: 1; padding: 4px 8px; border: 1px solid #ced4da; border-radius: 3px; font-size: 13px;">
                <button class="remove-feature-btn" onclick="this.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; margin-left: 8px; font-size: 12px;">åˆ é™¤</button>
            `;
            container.appendChild(featureDiv);
        }

        function addExample() {
            const container = document.getElementById('examplesList');
            const exampleDiv = document.createElement('div');
            exampleDiv.className = 'example-config';
            exampleDiv.innerHTML = `
                <h4>è‡ªå®šä¹‰ç¤ºä¾‹</h4>
                <div class="form-group">
                    <label>ç”¨æˆ·é—®é¢˜ï¼š</label>
                    <input type="text" placeholder="è¾“å…¥ç¤ºä¾‹é—®é¢˜">
                </div>
                <div class="form-group">
                    <label>æ¨èè·¯å¾„ï¼š</label>
                    <input type="text" placeholder="ä¾‹å¦‚ï¼šA1â†’B1,B2â†’C1,C3â†’D1">
                </div>
                <div class="form-group">
                    <label>é€»è¾‘è¯´æ˜ï¼š</label>
                    <textarea placeholder="è§£é‡Šä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªè·¯å¾„"></textarea>
                </div>
                <button class="remove-feature-btn" onclick="this.parentElement.remove()">åˆ é™¤ç¤ºä¾‹</button>
            `;
            container.appendChild(exampleDiv);
        }

        function updateNodeNames() {
            // æ›´æ–°ç¬¬ä¸€å±‚èŠ‚ç‚¹
            currentConfig.layers.layer1.nodes.forEach((nodeInfo, index) => {
                const nodeId = `node-A${index + 1}`;
                const nodeElement = document.getElementById(nodeId);
                if (nodeElement) {
                    const textElement = nodeElement.querySelector('.node-text');
                    const tooltipElement = nodeElement.querySelector('.tooltip');
                    if (textElement) {
                        textElement.textContent = nodeInfo.name;
                    }
                    if (tooltipElement) {
                        tooltipElement.textContent = nodeInfo.description;
                    }
                }
            });

            // æ›´æ–°ç¬¬äºŒå±‚èŠ‚ç‚¹
            currentConfig.layers.layer2.nodes.forEach((nodeInfo, index) => {
                const nodeId = `node-B${index + 1}`;
                const nodeElement = document.getElementById(nodeId);
                if (nodeElement) {
                    const textElement = nodeElement.querySelector('.node-text');
                    const tooltipElement = nodeElement.querySelector('.tooltip');
                    if (textElement) {
                        textElement.textContent = nodeInfo.name;
                    }
                    if (tooltipElement) {
                        tooltipElement.textContent = nodeInfo.description;
                    }
                }
            });

            // æ›´æ–°ç¬¬ä¸‰å±‚èŠ‚ç‚¹
            currentConfig.layers.layer3.nodes.forEach((nodeInfo, index) => {
                const nodeId = `node-C${index + 1}`;
                const nodeElement = document.getElementById(nodeId);
                if (nodeElement) {
                    const textElement = nodeElement.querySelector('.node-text');
                    const tooltipElement = nodeElement.querySelector('.tooltip');
                    if (textElement) {
                        textElement.textContent = nodeInfo.name;
                    }
                    if (tooltipElement) {
                        tooltipElement.textContent = nodeInfo.description;
                    }
                }
            });

            // æ›´æ–°ç¬¬å››å±‚èŠ‚ç‚¹
            currentConfig.layers.layer4.nodes.forEach((nodeInfo, index) => {
                const nodeId = `node-D${index + 1}`;
                const nodeElement = document.getElementById(nodeId);
                if (nodeElement) {
                    const textElement = nodeElement.querySelector('.node-text');
                    const tooltipElement = nodeElement.querySelector('.tooltip');
                    if (textElement) {
                        textElement.textContent = nodeInfo.name;
                    }
                    if (tooltipElement) {
                        tooltipElement.textContent = nodeInfo.description;
                    }
                }
            });
        }

        function saveConfig() {
            // ä¿å­˜å±‚çº§é…ç½®
            for (let i = 1; i <= 4; i++) {
                const layerId = 'layer' + i;
                const expectedNodeCount = layerNodeCounts[layerId];
                
                // è·å–èŠ‚ç‚¹åç§°å’Œæè¿°è¾“å…¥æ¡†çš„å€¼
                const nodeContainers = document.querySelectorAll(`#${layerId}Nodes .node-config`);
                const nodes = [];
                
                for (let j = 0; j < expectedNodeCount; j++) {
                    let nodeInfo;
                    if (j < nodeContainers.length) {
                        const nameInput = nodeContainers[j].querySelector('.node-name-input');
                        const descInput = nodeContainers[j].querySelector('.node-desc-input');
                        const featureInputs = nodeContainers[j].querySelectorAll('.node-features-list input');
                        
                        const nodeName = nameInput ? nameInput.value.trim() : '';
                        const nodeDesc = descInput ? descInput.value.trim() : '';
                        const nodeFeatures = Array.from(featureInputs).map(input => input.value.trim()).filter(v => v);
                        
                        nodeInfo = {
                            name: nodeName || (j < currentConfig.layers[layerId].nodes.length ? currentConfig.layers[layerId].nodes[j].name : `èŠ‚ç‚¹${j + 1}`),
                            description: nodeDesc || (j < currentConfig.layers[layerId].nodes.length ? currentConfig.layers[layerId].nodes[j].description : `èŠ‚ç‚¹${j + 1}æè¿°`),
                            features: nodeFeatures.length > 0 ? nodeFeatures : (j < currentConfig.layers[layerId].nodes.length && currentConfig.layers[layerId].nodes[j].features ? currentConfig.layers[layerId].nodes[j].features : [])
                        };
                    } else if (j < currentConfig.layers[layerId].nodes.length) {
                        nodeInfo = currentConfig.layers[layerId].nodes[j];
                    } else {
                        nodeInfo = { name: `èŠ‚ç‚¹${j + 1}`, description: `èŠ‚ç‚¹${j + 1}æè¿°`, features: [] };
                    }
                    nodes.push(nodeInfo);
                }
                
                currentConfig.layers[layerId] = {
                    name: document.getElementById(layerId + 'Name').value,
                    meaning: document.getElementById(layerId + 'Meaning').value,
                    nodes: nodes,
                    features: Array.from(document.querySelectorAll(`#${layerId}Features input`))
                        .map(input => input.value.trim()).filter(v => v)
                };
            }
            
            // ä¿å­˜OpenAIé…ç½®
            currentConfig.openai = {
                url: document.getElementById('openaiUrl').value,
                key: document.getElementById('openaiKey').value,
                model: document.getElementById('openaiModel').value
            };
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('distillationConfig', JSON.stringify(currentConfig));
            
            // æ›´æ–°èŠ‚ç‚¹æ˜¾ç¤º
            updateNodeNames();
            
            alert('é…ç½®å·²ä¿å­˜ï¼èŠ‚ç‚¹åç§°å’Œæè¿°å·²æ›´æ–°ã€‚');
            closeConfig();
        }

        function loadConfig() {
            const saved = localStorage.getItem('distillationConfig');
            if (saved) {
                currentConfig = JSON.parse(saved);
            }
            
            // åŠ è½½å±‚çº§é…ç½®
            for (let i = 1; i <= 4; i++) {
                const layerId = 'layer' + i;
                const config = currentConfig.layers[layerId];
                const expectedNodeCount = layerNodeCounts[layerId];
                
                document.getElementById(layerId + 'Name').value = config.name;
                document.getElementById(layerId + 'Meaning').value = config.meaning;
                
                // åŠ è½½èŠ‚ç‚¹åç§°å’Œæè¿°
                const nodesContainer = document.getElementById(layerId + 'Nodes');
                nodesContainer.innerHTML = '';
                
                // æ˜¾ç¤ºæ­£ç¡®æ•°é‡çš„èŠ‚ç‚¹è¾“å…¥æ¡†
                for (let j = 0; j < expectedNodeCount; j++) {
                    const nodeInfo = j < config.nodes.length ? config.nodes[j] : { name: `èŠ‚ç‚¹${j + 1}`, description: `èŠ‚ç‚¹${j + 1}æè¿°`, features: [] };
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = 'node-config';
                    nodeDiv.style.cssText = 'margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 1px solid #e9ecef;';
                    
                    // ç”Ÿæˆç‰¹å¾åˆ—è¡¨HTML
                    const featuresHtml = (nodeInfo.features || []).map(feature => `
                        <div class="feature-item" style="display: flex; align-items: center; margin-bottom: 8px; padding: 6px; background: white; border-radius: 5px; border: 1px solid #e9ecef;">
                            <input type="text" value="${feature}" style="flex: 1; padding: 4px 8px; border: 1px solid #ced4da; border-radius: 3px; font-size: 13px;">
                            <button class="remove-feature-btn" onclick="this.parentElement.remove()" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; margin-left: 8px; font-size: 12px;">åˆ é™¤</button>
                        </div>
                    `).join('');
                    
                    nodeDiv.innerHTML = `
                        <div style="margin-bottom: 12px;">
                            <label style="display: block; font-weight: bold; margin-bottom: 6px; color: #495057; font-size: 15px;">èŠ‚ç‚¹${j + 1} åç§°ï¼š</label>
                            <input type="text" class="node-name-input" value="${nodeInfo.name}" placeholder="è¾“å…¥èŠ‚ç‚¹åç§°" 
                                   style="width: 100%; padding: 8px 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                        </div>
                        <div style="margin-bottom: 12px;">
                            <label style="display: block; font-weight: bold; margin-bottom: 6px; color: #495057; font-size: 15px;">èŠ‚ç‚¹${j + 1} æè¿°ï¼š</label>
                            <input type="text" class="node-desc-input" value="${nodeInfo.description}" placeholder="è¾“å…¥èŠ‚ç‚¹æè¿°" 
                                   style="width: 100%; padding: 8px 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: bold; margin-bottom: 6px; color: #495057; font-size: 15px;">èŠ‚ç‚¹${j + 1} ç‰¹å¾ï¼š</label>
                            <div class="node-features-list">
                                ${featuresHtml}
                            </div>
                            <button class="add-node-feature-btn" onclick="addNodeFeature(this)" 
                                    style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 13px; margin-top: 8px;">
                                + æ·»åŠ ç‰¹å¾
                            </button>
                        </div>
                    `;
                    nodesContainer.appendChild(nodeDiv);
                }
                
                // åŠ è½½ç‰¹å¾
                const featuresContainer = document.getElementById(layerId + 'Features');
                featuresContainer.innerHTML = '';
                config.features.forEach(feature => {
                    const featureDiv = document.createElement('div');
                    featureDiv.className = 'feature-item';
                    featureDiv.innerHTML = `
                        <input type="text" value="${feature}">
                        <button class="remove-feature-btn" onclick="this.parentElement.remove()">åˆ é™¤</button>
                    `;
                    featuresContainer.appendChild(featureDiv);
                });
            }
            
            // åŠ è½½OpenAIé…ç½®
            document.getElementById('openaiUrl').value = currentConfig.openai.url;
            document.getElementById('openaiKey').value = currentConfig.openai.key;
            document.getElementById('openaiModel').value = currentConfig.openai.model;
            
            // æ›´æ–°èŠ‚ç‚¹æ˜¾ç¤º
            updateNodeNames();
        }

        function generatePrompt(userQuestion) {
            // ç”Ÿæˆè¯¦ç»†çš„èŠ‚ç‚¹ä¿¡æ¯
            let detailedNodesInfo = '';
            
            Object.entries(currentConfig.layers).forEach(([layerKey, layer], layerIndex) => {
                const layerNumber = layerIndex + 1;
                const layerLetter = String.fromCharCode(65 + layerIndex); // A, B, C, D
                
                detailedNodesInfo += `\nç¬¬${layerNumber}å±‚ - ${layer.name}ï¼š\n`;
                detailedNodesInfo += `å±‚å«ä¹‰ï¼š${layer.meaning}\n`;
                
                layer.nodes.forEach((node, nodeIndex) => {
                    const nodeId = `${layerLetter}${nodeIndex + 1}`;
                    detailedNodesInfo += `  ${nodeId}. ${node.name}\n`;
                    detailedNodesInfo += `     æè¿°ï¼š${node.description}\n`;
                    if (node.features && node.features.length > 0) {
                        detailedNodesInfo += `     ç‰¹å¾ï¼š${node.features.join('ã€')}\n`;
                    }
                    detailedNodesInfo += `\n`;
                });
            });
            
            // ç”ŸæˆèŠ‚ç‚¹ç¼–å·å¯¹ç…§è¡¨
            const nodeMapping = Object.entries(currentConfig.layers).map(([layerKey, layer], layerIndex) => {
                const layerLetter = String.fromCharCode(65 + layerIndex);
                const nodeList = layer.nodes.map((node, nodeIndex) => 
                    `${layerLetter}${nodeIndex + 1}-${node.name}`
                ).join(', ');
                return `ç¬¬${layerIndex + 1}å±‚(${layerLetter}): ${nodeList}`;
            }).join('\n');
            
            const examples = currentConfig.examples
                .map(ex => `é—®é¢˜: ${ex.question}\nè·¯å¾„: ${ex.path}\né€»è¾‘: ${ex.logic}`)
                .join('\n\n');
            
            return `ä½ æ˜¯ä¸€ä¸ªè’¸é¦ä¸“å®¶ç³»ç»Ÿã€‚æ ¹æ®ä»¥ä¸‹è¯¦ç»†çš„èŠ‚ç‚¹ä¿¡æ¯å’Œç¤ºä¾‹ï¼Œä¸ºç”¨æˆ·é—®é¢˜æ¨èæœ€åˆé€‚çš„å¤„ç†è·¯å¾„ã€‚

=== è¯¦ç»†èŠ‚ç‚¹ä¿¡æ¯ ===${detailedNodesInfo}

=== èŠ‚ç‚¹ç¼–å·å¯¹ç…§è¡¨ ===
${nodeMapping}

=== è·¯å¾„æ¨èç¤ºä¾‹ ===
${examples}

=== ç”¨æˆ·é—®é¢˜ ===
${userQuestion}

=== åˆ†æè¦æ±‚ ===
è¯·æ ¹æ®ç”¨æˆ·é—®é¢˜ï¼Œç»“åˆæ¯ä¸ªèŠ‚ç‚¹çš„ç‰¹å¾å’Œæè¿°ï¼Œé€‰æ‹©æœ€åˆé€‚çš„å¤„ç†è·¯å¾„ï¼š

1. ç¬¬ä¸€å±‚(A)ï¼šå›ºå®šé€‰æ‹© A1-${currentConfig.layers.layer1.nodes[0].name}
2. ç¬¬äºŒå±‚(B)ï¼šæ ¹æ®é—®é¢˜éœ€æ±‚ï¼Œä»4ä¸ªåŸææ–™ä¸­é€‰æ‹©åˆé€‚çš„ï¼ˆå¯å¤šé€‰ï¼‰
   - è€ƒè™‘æ¯ç§åŸææ–™çš„ç‰¹å¾å’Œé€‚ç”¨åœºæ™¯
3. ç¬¬ä¸‰å±‚(C)ï¼šæ ¹æ®è´¨é‡ã€æ•ˆç‡ã€æˆæœ¬éœ€æ±‚ï¼Œä»9ç§è’¸é¦æ–¹æ³•ä¸­é€‰æ‹©ï¼ˆå¯å¤šé€‰ï¼‰
   - è€ƒè™‘æ¯ç§æ–¹æ³•çš„åˆ†ç¦»ç²¾åº¦ã€èƒ½è€—ã€å¤æ‚åº¦ç­‰ç‰¹å¾
4. ç¬¬å››å±‚(D)ï¼šæ ¹æ®æœ€ç»ˆç›®æ ‡ï¼Œé€‰æ‹©å¯¹åº”çš„ä¸“å®¶æ¨¡å‹
   - D1-è´¨é‡ä¸“å®¶ï¼šè¿½æ±‚é«˜çº¯åº¦ã€é«˜è´¨é‡
   - D2-æ•ˆç‡ä¸“å®¶ï¼šè¿½æ±‚é«˜æ•ˆç‡ã€å¿«é€Ÿç”Ÿäº§
   - D3-æˆæœ¬ä¸“å®¶ï¼šè¿½æ±‚ä½æˆæœ¬ã€ç»æµæ€§

è¯·è¿”å›JSONæ ¼å¼çš„è·¯å¾„æ¨èï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
{"ONE":["A1"],"TWO":["B1","B2"],"THREE":["C1","C3","C4"],"FOUR":["D1"]}

æ³¨æ„ï¼šåªè¿”å›JSONï¼Œä¸è¦å…¶ä»–è§£é‡Šæ–‡å­—ã€‚`;
        }

        async function analyzeQuestion() {
            const question = document.getElementById('userQuestion').value.trim();
            if (!question) {
                alert('è¯·è¾“å…¥é—®é¢˜ï¼');
                return;
            }
            
            if (!currentConfig.openai.key) {
                alert('è¯·å…ˆé…ç½®OpenAI API Keyï¼');
                openConfig();
                showTab('openai');
                return;
            }
            
            try {
                const prompt = generatePrompt(question);
                console.log('Generated prompt:', prompt);
                
                const response = await fetch(currentConfig.openai.url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentConfig.openai.key}`
                    },
                    body: JSON.stringify({
                        model: currentConfig.openai.model,
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                console.log('AI Response:', aiResponse);
                
                // è§£æJSONå“åº”
                const pathRecommendation = JSON.parse(aiResponse);
                console.log('Parsed path:', pathRecommendation);
                
                // æ ¹æ®AIæ¨èçš„è·¯å¾„é«˜äº®æ˜¾ç¤º
                highlightAIPath(pathRecommendation);
                
            } catch (error) {
                console.error('AIåˆ†æå¤±è´¥:', error);
                alert('AIåˆ†æå¤±è´¥: ' + error.message);
            }
        }

        function highlightAIPath(pathData) {
            resetAnimation();
            
            // åˆ›å»ºè‡ªå®šä¹‰è·¯å¾„
            const aiPathway = {
                name: 'AIæ¨èè·¯å¾„',
                color: '#FFD700',
                path: [
                    { from: pathData.ONE, to: pathData.TWO },
                    { from: pathData.TWO, to: pathData.THREE },
                    { from: pathData.THREE, to: pathData.FOUR }
                ]
            };
            
            // æ¸…é™¤ç°æœ‰è¿æ¥å¹¶åˆ›å»ºAIè·¯å¾„è¿æ¥
            connections.forEach(conn => conn.remove());
            connections = [];
            
            // åˆ›å»ºAIæ¨èçš„è¿æ¥çº¿
            aiPathway.path.forEach(step => {
                const fromNodes = Array.isArray(step.from) ? step.from : [step.from];
                const toNodes = Array.isArray(step.to) ? step.to : [step.to];
                
                fromNodes.forEach(fromId => {
                    toNodes.forEach(toId => {
                        createConnection(fromId, toId, aiPathway.color, 'ai-pathway');
                    });
                });
            });
            
            // æ’­æ”¾åŠ¨ç”»
            setTimeout(() => {
                animatePathway(aiPathway, 'ai-pathway', 0);
            }, 500);
        }

        function createConnections() {
            const network = document.getElementById('network');
            
            // æ¸…é™¤ç°æœ‰è¿æ¥
            connections.forEach(conn => conn.remove());
            connections = [];

            // ä¸ºæ¯ä¸ªè·¯å¾„åˆ›å»ºè¿æ¥çº¿
            Object.keys(pathways).forEach(pathKey => {
                const pathway = pathways[pathKey];
                pathway.path.forEach(step => {
                    const fromNodes = Array.isArray(step.from) ? step.from : [step.from];
                    const toNodes = Array.isArray(step.to) ? step.to : [step.to];
                    
                    fromNodes.forEach(fromId => {
                        toNodes.forEach(toId => {
                            createConnection(fromId, toId, pathway.color, pathKey);
                        });
                    });
                });
            });
        }

        function getNodeById(nodeId) {
            const layer = nodeId[0];
            const index = parseInt(nodeId.slice(1)) - 1;
            
            let selector;
            switch(layer) {
                case 'A': selector = '[data-layer="input"]'; break;
                case 'B': selector = '[data-layer="material"]'; break;
                case 'C': selector = '[data-layer="distillation"]'; break;
                case 'D': selector = '[data-layer="expert"]'; break;
            }
            
            const nodes = document.querySelectorAll(selector);
            return nodes[index];
        }

        function getNodeEdgePosition(node, targetNode) {
            const nodeRect = node.getBoundingClientRect();
            const targetRect = targetNode.getBoundingClientRect();
            const networkRect = document.getElementById('network').getBoundingClientRect();
            
            const nodeCenterX = nodeRect.left + nodeRect.width / 2 - networkRect.left;
            const nodeCenterY = nodeRect.top + nodeRect.height / 2 - networkRect.top;
            const targetCenterX = targetRect.left + targetRect.width / 2 - networkRect.left;
            const targetCenterY = targetRect.top + targetRect.height / 2 - networkRect.top;
            
            // è®¡ç®—æ–¹å‘å‘é‡
            const dx = targetCenterX - nodeCenterX;
            const dy = targetCenterY - nodeCenterY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // è®¡ç®—èŠ‚ç‚¹è¾¹ç¼˜ç‚¹ï¼ˆä»ä¸­å¿ƒå‘ç›®æ ‡æ–¹å‘åç§»åŠå¾„è·ç¦»ï¼‰
            const radius = nodeRect.width / 2 - 2; // ç¨å¾®å†…ç¼©é¿å…é‡å 
            const offsetX = (dx / distance) * radius;
            const offsetY = (dy / distance) * radius;
            
            return {
                x: nodeCenterX + offsetX,
                y: nodeCenterY + offsetY
            };
        }

        function createConnection(fromId, toId, color, pathway) {
            const fromNode = getNodeById(fromId);
            const toNode = getNodeById(toId);
            
            if (!fromNode || !toNode) return;
            
            const startPos = getNodeEdgePosition(fromNode, toNode);
            const endPos = getNodeEdgePosition(toNode, fromNode);
            
            const deltaX = endPos.x - startPos.x;
            const deltaY = endPos.y - startPos.y;
            const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);

            const connection = document.createElement('div');
            connection.className = 'connection';
            connection.setAttribute('data-pathway', pathway);
            connection.setAttribute('data-from', fromId);
            connection.setAttribute('data-to', toId);
            connection.style.position = 'absolute';
            connection.style.left = startPos.x + 'px';
            connection.style.top = startPos.y + 'px';
            connection.style.width = length + 'px';
            connection.style.height = '3px';
            connection.style.background = `rgba(${hexToRgb(color)}, 0.3)`;
            connection.style.transformOrigin = '0 50%';
            connection.style.transform = `rotate(${angle}deg)`;
            connection.style.opacity = '0.7';
            connection.style.transition = 'all 0.3s ease';
            connection.style.display = connectionsVisible ? 'block' : 'none';
            connection.style.zIndex = '1';
            connection.style.borderRadius = '2px';

            document.getElementById('network').appendChild(connection);
            connections.push(connection);
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? 
                `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : 
                '0, 0, 0';
        }

        function startAnimation() {
            if (animationRunning) return;
            
            animationRunning = true;
            
            // é‡ç½®æ‰€æœ‰çŠ¶æ€
            resetAnimation();
            
            let delay = 0;
            
            // ä¾æ¬¡å±•ç¤ºä¸‰æ¡è·¯å¾„
            Object.keys(pathways).forEach((pathKey, pathIndex) => {
                const pathway = pathways[pathKey];
                
                setTimeout(() => {
                    animatePathway(pathway, pathKey, pathIndex);
                }, delay);
                
                delay += 4000; // æ¯æ¡è·¯å¾„é—´éš”4ç§’
            });
            
            // æœ€ç»ˆå±•ç¤ºæ‰€æœ‰è·¯å¾„
            setTimeout(() => {
                showAllPathways();
            }, delay);
            
            setTimeout(() => {
                animationRunning = false;
            }, delay + 3000);
        }

        function animatePathway(pathway, pathKey, pathIndex) {
            console.log(`å±•ç¤º${pathway.name}`);
            
            let stepDelay = 0;
            
            pathway.path.forEach((step, stepIndex) => {
                setTimeout(() => {
                    const fromNodes = Array.isArray(step.from) ? step.from : [step.from];
                    const toNodes = Array.isArray(step.to) ? step.to : [step.to];
                    
                    // æ¿€æ´»èµ·å§‹èŠ‚ç‚¹
                    fromNodes.forEach(nodeId => {
                        const node = getNodeById(nodeId);
                        if (node) {
                            node.classList.add('active');
                            node.style.boxShadow = `0 0 20px ${pathway.color}`;
                        }
                    });
                    
                    // æ¿€æ´»è¿æ¥çº¿
                    setTimeout(() => {
                        fromNodes.forEach(fromId => {
                            toNodes.forEach(toId => {
                                const connection = document.querySelector(
                                    `[data-pathway="${pathKey}"][data-from="${fromId}"][data-to="${toId}"]`
                                );
                                if (connection) {
                                    connection.style.background = `linear-gradient(90deg, ${pathway.color}, ${pathway.color})`;
                                    connection.style.opacity = '1';
                                    connection.style.boxShadow = `0 0 8px ${pathway.color}`;
                                    connection.style.height = '4px';
                                    connection.classList.add('active');
                                }
                            });
                        });
                        
                        // æ¿€æ´»ç›®æ ‡èŠ‚ç‚¹
                        setTimeout(() => {
                            toNodes.forEach(nodeId => {
                                const node = getNodeById(nodeId);
                                if (node) {
                                    node.classList.add('active');
                                    node.style.boxShadow = `0 0 20px ${pathway.color}`;
                                }
                            });
                        }, 300);
                    }, 200);
                    
                }, stepDelay);
                
                stepDelay += 1000;
            });
        }

        function showAllPathways() {
            // æ˜¾ç¤ºæ‰€æœ‰è·¯å¾„çš„æœ€ç»ˆæ•ˆæœ
            connections.forEach(conn => {
                const pathway = conn.getAttribute('data-pathway');
                const color = pathways[pathway].color;
                conn.style.background = `linear-gradient(90deg, ${color}, ${color})`;
                conn.style.opacity = '0.8';
                conn.style.boxShadow = `0 0 6px ${color}`;
                conn.classList.add('active');
            });
            
            document.querySelectorAll('.node').forEach(node => {
                node.classList.add('active');
            });
        }

        function resetAnimation() {
            animationRunning = false;
            
            // é‡ç½®è¿æ¥çº¿
            document.querySelectorAll('.connection').forEach(conn => {
                conn.classList.remove('active');
                const pathway = conn.getAttribute('data-pathway');
                const color = pathways[pathway].color;
                conn.style.background = `rgba(${hexToRgb(color)}, 0.3)`;
                conn.style.opacity = '0.7';
                conn.style.boxShadow = 'none';
                conn.style.height = '3px';
                conn.style.animation = 'none';
            });
            
            // é‡ç½®èŠ‚ç‚¹
            document.querySelectorAll('.node').forEach(node => {
                node.classList.remove('active');
                node.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
            });
        }

        function toggleConnections() {
            connectionsVisible = !connectionsVisible;
            connections.forEach(conn => {
                conn.style.display = connectionsVisible ? 'block' : 'none';
            });
        }

        // ç¡®ä¿DOMå®Œå…¨åŠ è½½åå†åˆ›å»ºè¿æ¥
        function initializeNetwork() {
            setTimeout(() => {
                updateNodeNames(); // åˆå§‹åŒ–æ—¶æ›´æ–°èŠ‚ç‚¹åç§°
                createConnections();
            }, 800);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç½‘ç»œ
        window.addEventListener('load', initializeNetwork);

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°åˆ›å»ºè¿æ¥
        window.addEventListener('resize', () => {
            setTimeout(createConnections, 300);
        });

        // èŠ‚ç‚¹æ‚¬åœæ•ˆæœ
        document.addEventListener('DOMContentLoaded', () => {
            const nodes = document.querySelectorAll('.node');
            nodes.forEach(node => {
                node.addEventListener('mouseenter', () => {
                    node.style.zIndex = '100';
                });
                
                node.addEventListener('mouseleave', () => {
                    node.style.zIndex = 'auto';
                });
            });
            
            // åˆå§‹åŒ–æ—¶ç«‹å³æ›´æ–°èŠ‚ç‚¹åç§°
            setTimeout(() => {
                updateNodeNames();
            }, 1000);
        });
    </script>
</body>
</html> 